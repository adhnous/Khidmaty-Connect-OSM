export type Locale = 'en' | 'ar';

const dict = {
  en: {
    header: {
      browse: 'Browse Services',
      providers: 'For Providers',
      providerDashboard: 'Provider Dashboard',
      myServices: 'My Services',
      addService: 'Add New Service',
      profile: 'Profile',
      signOut: 'Sign Out',
      login: 'Login / Sign Up',
      switch: 'Switch language',
    },
    login: {
      welcome: 'Welcome',
      subtitle: 'Sign in or create an account to continue',
      tabs: { signin: 'Sign In', signup: 'Sign Up' },
      fields: {
        email: 'Email',
        password: 'Password',
        roleLabel: 'I am a...',
        roleSeeker: 'Service Seeker (Looking for a professional)',
        roleProvider: 'Service Provider (Offering my services)',
      },
      actions: {
        signIn: 'Sign In',
        signUp: 'Create Account',
        forgot: 'Forgot password?',
      },
      toasts: {
        accountCreatedTitle: 'Account Created',
        accountCreatedDesc: 'You have been successfully signed up.',
        signedInTitle: 'Signed In',
        signedInDesc: 'You have been successfully signed in.',
        emailInUseTitle: 'Email already in use',
        emailInUseDesc: 'We switched you to Sign In. If you forgot your password, click "Forgot password?"',
        signUpFailedTitle: 'Sign Up Failed',
        signUpFailedDesc: 'An unexpected error occurred.',
        signOutFailedTitle: 'Sign Out Failed',
        signOutFailedDesc: 'There was an error signing out.',
        emailRequiredTitle: 'Email required',
        emailRequiredDesc: 'Enter your email, then click Forgot password.',
        resetSentTitle: 'Password reset sent',
        resetSentDesc: 'Check your email for a reset link.',
        resetFailedTitle: 'Reset failed',
        resetFailedDesc: 'Could not send reset email.',
        redirectFailedTitle: 'Redirect failed',
        redirectFailedDesc: 'Could not retrieve user profile for redirection.',
      },
      serviceForm: {
        newTitle: 'Create a new service',
        newSubtitle: 'Fill out the details below to list your service on Khidmaty Connect.',
        editTitle: 'Edit service',
        editSubtitle: 'Update your listing information.',
        saveChanges: 'Save Changes',
        saving: 'Saving…',
        notAllowedTitle: 'Not allowed',
        notAllowedDesc: 'You can only edit your own service.',
      },
    },
    home: {
      heroTitle: 'Find Local Services You Can Trust',
      heroSubtitle: 'Your connection to skilled professionals in Libya.',
      searchPlaceholder: 'What service are you looking for?',
      cityPlaceholder: 'City',
      categoryPlaceholder: 'Category',
      allCities: 'All Cities',
      allCategories: 'All Categories',
      maxPricePlaceholder: 'Max price',
      search: 'Search',
      featuredCategories: 'Featured Categories',
      popularServices: 'Popular Services',
      loading: 'Loading services…',
      empty1: 'No real services yet. The cards below are demos and not clickable.',
      empty2: 'Go to Dashboard → My Services to create a new service or click Seed samples there to add example listings.',
      sortBy: 'Sort by',
      sortNewest: 'Newest',
      sortPriceLow: 'Price: Low to High',
      sortPriceHigh: 'Price: High to Low',
    },
    categories: {
      Plumbing: 'Plumbing',
      'Home Services': 'Home Services',
      Automotive: 'Automotive',
      Education: 'Education',
      Electrical: 'Electrical',
      Carpentry: 'Carpentry',
      Gardening: 'Gardening',
    },
    details: {
      loading: 'Loading service…',
      notFoundTitle: 'Service not found',
      notFoundBodyError: 'There was a problem loading this service.',
      notFoundBodyRemoved: 'This service may have been removed.',
      goHome: 'Go to homepage',
      backToMyServices: 'Back to My Services',
      description: 'Description',
      availability: 'Availability',
      location: 'Location',
      approxIn: 'Approximate location in',
      video: 'Video',
      servicePrice: 'Service Price',
      contactWhatsApp: 'Contact via WhatsApp',
      callProvider: 'Call Provider',
      noContact: 'Contact details not provided.',
      chatInApp: 'Chat with Provider',
      reviews: 'Reviews & Ratings',
    },
    chat: {
      title: 'Chat',
      typeMessage: 'Type a message…',
      send: 'Send',
      start: 'Start a conversation',
      notAllowed: 'You do not have access to this conversation.',
      signInPrompt: 'Please sign in to chat.',
      empty: 'No messages yet.'
    },
    reviews: {
      ratingLabel: 'Your rating',
      writeReview: 'Write a review',
      placeholder: 'Share your experience (optional, up to 1000 characters)…',
      submit: 'Submit review',
      update: 'Update review',
      delete: 'Delete review',
      signInPrompt: 'Sign in to leave a review.',
      ownerBlocked: 'You cannot review your own service.',
      empty: 'No reviews yet.',
      toasts: {
        saved: 'Review saved',
        deleted: 'Review deleted',
        saveFailed: 'Could not save review',
        deleteFailed: 'Could not delete review',
        requiredRating: 'Please select a star rating.',
      },
    },
    form: {
      labels: {
        title: 'Service Title',
        description: 'Description',
        category: 'Category',
        price: 'Price (in LYD)',
        city: 'City',
        area: 'Area / Neighborhood',
        latitude: 'Latitude (optional)',
        longitude: 'Longitude (optional)',
        pickLocation: 'Pick location on map (optional)',
        availabilityNote: 'Availability Note (optional)',
        contactPhone: 'Contact Phone',
        contactWhatsapp: 'WhatsApp Number',
        videoUrl: 'YouTube Video URL (optional)',
        images: 'Service Images (1-8)',
      },
      placeholders: {
        title: 'e.g., Expert Home AC Repair and Maintenance',
        description: 'Describe your service in detail...',
        availability: 'e.g., Available evenings and weekends',
        searchAddress: 'Search address or place (free)',
      },
      help: {
        description: 'Max 800 characters. Be clear and comprehensive.',
        videoUrl: 'Paste a YouTube link. It will be embedded on your service page.',
        imageTypes: 'PNG, JPG, or WebP (MAX. 8 images)',
        coverImage: 'The first image will be the main cover image for your service.',
      },
      actions: {
        improve: 'Improve',
        useMyLocation: 'Use my location',
        clearLocation: 'Clear location',
        clickToUpload: 'Click to upload or drag and drop',
        createService: 'Create Service',
      },
      images: {
        label: 'Service Images (1-8)',
        addFiles: 'Add files',
        pasteUrlPlaceholder: 'Paste image URL',
        addUrl: 'Add URL',
        replace: 'Replace',
        replaceUrl: 'Replace URL',
        remove: 'Remove',
        moveUp: 'Up',
        moveDown: 'Down',
        none: 'No images yet.',
        selectedCount: 'Selected {count} file(s): {names}',
      },
      toasts: {
        createdTitle: 'Service Created',
        createdDesc: 'Your service has been published successfully.',
        createFailedTitle: 'Could not create service',
        updateSuccess: 'Service updated',
        updateFailedTitle: 'Update failed',
        pleaseSignInTitle: 'Please sign in',
        pleaseSignInDesc: 'You must be signed in to continue.',
        imagesAdded: 'Images added',
        addImagesFailed: 'Add images failed',
        imageReplaced: 'Image replaced',
        replaceFailed: 'Replace failed',
        imageUploadFailed: 'Image upload failed',
        aiTitleImproved: 'Title improved!',
        aiSuggested: 'AI has suggested a new title.',
        aiErrorTitle: 'Error',
        aiErrorDesc: 'Could not improve title.',
      },
      geo: {
        notAvailableTitle: 'Geolocation not available',
        notAvailableDesc: 'Your browser does not support geolocation.',
        setTitle: 'Location set',
        setDesc: '{lat}, {lng}',
        couldNotGetTitle: 'Could not get location',
        couldNotGetDesc: 'Permission denied',
      },
      ai: {
        suggestions: 'AI Suggestions:',
      },
      map: {
        selected: 'Selected',
        clickToSet: 'Click on the map to set a precise location.',
        openInOSM: 'Open in OSM',
      },
    },
    dashboard: {
      services: {
        title: 'My Services',
        subtitle: 'View and manage all your service listings.',
        newService: 'New Service',
        seedSamples: 'Seed samples',
        loading: 'Loading…',
        emptyTitle: 'You have no services yet.',
        createFirst: 'Create your first service',
        seedSampleServices: 'Seed sample services',
        table: {
          headers: {
            title: 'Title',
            category: 'Category',
            city: 'City',
            price: 'Price (LYD)',
            actions: 'Actions',
          },
        },
        actions: {
          view: 'View',
          edit: 'Edit',
          delete: 'Delete',
        },
        toast: {
          deleted: 'Service deleted',
          deleteFailed: 'Delete failed',
          seeded: 'Sample services created',
          seedFailed: 'Seeding failed',
        },
        confirmDelete: 'Delete this service? This cannot be undone.',
      },
    },
    map: {
      usingOSMBadge: 'Using OpenStreetMap (free)'
    },
  },
  ar: {
    header: {
      browse: 'تصفح الخدمات',
      providers: 'للمقدّمين',
      providerDashboard: 'لوحة المزود',
      myServices: 'خدماتي',
      addService: 'إضافة خدمة جديدة',
      profile: 'الملف الشخصي',
      signOut: 'تسجيل الخروج',
      login: 'تسجيل الدخول / إنشاء حساب',
      switch: 'تغيير اللغة',
    },
    login: {
      welcome: 'مرحبًا',
      subtitle: 'سجّل الدخول أو أنشئ حسابًا للمتابعة',
      tabs: { signin: 'تسجيل الدخول', signup: 'إنشاء حساب' },
      fields: {
        email: 'البريد الإلكتروني',
        password: 'كلمة المرور',
        roleLabel: 'أنا...',
        roleSeeker: 'طالب خدمة (أبحث عن محترف)',
        roleProvider: 'مقدّم خدمة (أعرض خدماتي)',
      },
      actions: {
        signIn: 'تسجيل الدخول',
        signUp: 'إنشاء حساب',
        forgot: 'هل نسيت كلمة المرور؟',
      },
      toasts: {
        accountCreatedTitle: 'تم إنشاء الحساب',
        accountCreatedDesc: 'تم إنشاء حسابك بنجاح.',
        signedInTitle: 'تم تسجيل الدخول',
        signedInDesc: 'تم تسجيل دخولك بنجاح.',
        emailInUseTitle: 'البريد الإلكتروني مستخدم بالفعل',
        emailInUseDesc: 'تم تحويلك إلى تسجيل الدخول. إذا نسيت كلمة المرور، اضغط "هل نسيت كلمة المرور؟"',
        signUpFailedTitle: 'فشل إنشاء الحساب',
        signUpFailedDesc: 'حدث خطأ غير متوقع.',
        signOutFailedTitle: 'فشل تسجيل الخروج',
        signOutFailedDesc: 'حدث خطأ أثناء تسجيل الخروج.',
        emailRequiredTitle: 'البريد الإلكتروني مطلوب',
        emailRequiredDesc: 'أدخل بريدك الإلكتروني ثم اضغط "هل نسيت كلمة المرور؟"',
        resetSentTitle: 'تم إرسال رابط الاستعادة',
        resetSentDesc: 'تفقد بريدك الإلكتروني للحصول على رابط إعادة التعيين.',
        resetFailedTitle: 'فشل الاستعادة',
        resetFailedDesc: 'تعذر إرسال بريد الاستعادة.',
        redirectFailedTitle: 'فشل التوجيه',
        redirectFailedDesc: 'تعذر استرجاع ملف المستخدم للتوجيه.',
      },
    },
    home: {
      heroTitle: 'اعثر على خدمات محلية تثق بها',
      heroSubtitle: 'صلتك بالمحترفين المهرة في ليبيا.',
      searchPlaceholder: 'ما الخدمة التي تبحث عنها؟',
      cityPlaceholder: 'المدينة',
      categoryPlaceholder: 'الفئة',
      allCities: 'جميع المدن',
      allCategories: 'جميع الفئات',
      maxPricePlaceholder: 'أقصى سعر',
      search: 'بحث',
      featuredCategories: 'أبرز الفئات',
      popularServices: 'خدمات شائعة',
      loading: 'جارٍ تحميل الخدمات…',
      empty1: 'لا توجد خدمات حقيقية بعد. البطاقات التالية للعرض فقط وغير قابلة للنقر.',
      empty2: 'اذهب إلى لوحة التحكم → خدماتي لإنشاء خدمة جديدة أو انقر "إضافة عينات" لإضافة أمثلة.',
      sortBy: 'الترتيب حسب',
      sortNewest: 'الأحدث',
      sortPriceLow: 'السعر: من الأقل إلى الأعلى',
      sortPriceHigh: 'السعر: من الأعلى إلى الأقل',
    },
    categories: {
      Plumbing: 'سباكة',
      'Home Services': 'خدمات منزلية',
      Automotive: 'خدمات السيارات',
      Education: 'تعليم',
      Electrical: 'كهرباء',
      Carpentry: 'نجارة',
      Gardening: 'تنسيق حدائق',
    },
    details: {
      loading: 'جارٍ تحميل الخدمة…',
      notFoundTitle: 'الخدمة غير موجودة',
      notFoundBodyError: 'حدثت مشكلة أثناء تحميل هذه الخدمة.',
      notFoundBodyRemoved: 'قد تم إزالة هذه الخدمة.',
      goHome: 'العودة إلى الصفحة الرئيسية',
      backToMyServices: 'العودة إلى خدماتي',
      description: 'الوصف',
      availability: 'التوفر',
      location: 'الموقع',
      approxIn: 'موقع تقريبي في',
      video: 'فيديو',
      servicePrice: 'سعر الخدمة',
      contactWhatsApp: 'تواصل عبر واتساب',
      callProvider: 'اتصل بالمقدم',
      noContact: 'لا توجد بيانات تواصل.',
      chatInApp: 'دردشة داخل التطبيق',
      reviews: 'التقييمات والمراجعات',
    },
    chat: {
      title: 'المحادثة',
      typeMessage: 'اكتب رسالة…',
      send: 'إرسال',
      start: 'ابدأ محادثة',
      notAllowed: 'ليس لديك صلاحية للوصول إلى هذه المحادثة.',
      signInPrompt: 'يرجى تسجيل الدخول للمحادثة.',
      empty: 'لا توجد رسائل بعد.'
    },
    reviews: {
      ratingLabel: 'تقييمك',
      writeReview: 'اكتب مراجعة',
      placeholder: 'شارك تجربتك (اختياري، حتى 1000 حرف)…',
      submit: 'إرسال المراجعة',
      update: 'تحديث المراجعة',
      delete: 'حذف المراجعة',
      signInPrompt: 'سجّل الدخول لترك مراجعة.',
      ownerBlocked: 'لا يمكنك مراجعة خدمتك الخاصة.',
      empty: 'لا توجد مراجعات بعد.',
      toasts: {
        saved: 'تم حفظ المراجعة',
        deleted: 'تم حذف المراجعة',
        saveFailed: 'تعذر حفظ المراجعة',
        deleteFailed: 'تعذر حذف المراجعة',
        requiredRating: 'يرجى اختيار تقييم النجوم.',
      },
    },
    form: {
      labels: {
        title: 'عنوان الخدمة',
        description: 'الوصف',
        category: 'الفئة',
        price: 'السعر (بالدينار الليبي)',
        city: 'المدينة',
        area: 'المنطقة / الحي',
        latitude: 'خط العرض (اختياري)',
        longitude: 'خط الطول (اختياري)',
        pickLocation: 'اختر الموقع على الخريطة (اختياري)',
        availabilityNote: 'ملاحظة التوفر (اختياري)',
        contactPhone: 'رقم الهاتف',
        contactWhatsapp: 'رقم واتساب',
        videoUrl: 'رابط فيديو يوتيوب (اختياري)',
        images: 'صور الخدمة (1-8)',
      },
      placeholders: {
        title: 'مثال: صيانة وتكييف منازل باحترافية',
        description: 'صف خدمتك بالتفصيل...',
        availability: 'مثال: متاح مساءً وعطلات نهاية الأسبوع',
        searchAddress: 'ابحث عن عنوان أو مكان (مجاني)',
      },
      help: {
        description: 'بحد أقصى 800 حرف. كن واضحًا ومختصرًا.',
        videoUrl: 'ألصق رابط يوتيوب وسيتم تضمينه في صفحة خدمتك.',
        imageTypes: 'PNG أو JPG أو WebP (حد أقصى 8 صور)',
        coverImage: 'ستكون الصورة الأولى هي صورة الغلاف الرئيسية للخدمة.',
      },
      actions: {
        improve: 'تحسين',
        useMyLocation: 'استخدم موقعي',
        clearLocation: 'مسح الموقع',
        clickToUpload: 'انقر للرفع أو اسحب وأفلت',
        createService: 'إنشاء الخدمة',
      },
      images: {
        label: 'صور الخدمة (1-8)',
        addFiles: 'إضافة ملفات',
        pasteUrlPlaceholder: 'ألصق رابط الصورة',
        addUrl: 'إضافة رابط',
        replace: 'استبدال',
        replaceUrl: 'استبدال الرابط',
        remove: 'حذف',
        moveUp: 'أعلى',
        moveDown: 'أسفل',
        none: 'لا توجد صور بعد.',
        selectedCount: 'تم اختيار {count} ملف: {names}',
      },
      toasts: {
        createdTitle: 'تم إنشاء الخدمة',
        createdDesc: 'تم نشر خدمتك بنجاح.',
        createFailedTitle: 'تعذر إنشاء الخدمة',
        updateSuccess: 'تم تحديث الخدمة',
        updateFailedTitle: 'فشل التحديث',
        pleaseSignInTitle: 'يرجى تسجيل الدخول',
        pleaseSignInDesc: 'يجب تسجيل الدخول للمتابعة.',
        imagesAdded: 'تمت إضافة الصور',
        addImagesFailed: 'فشل إضافة الصور',
        imageReplaced: 'تم استبدال الصورة',
        replaceFailed: 'فشل الاستبدال',
        imageUploadFailed: 'فشل رفع الصور',
        aiTitleImproved: 'تم تحسين العنوان!',
        aiSuggested: 'اقترح الذكاء الاصطناعي عنوانًا جديدًا.',
        aiErrorTitle: 'خطأ',
        aiErrorDesc: 'تعذر تحسين العنوان.',
      },
      geo: {
        notAvailableTitle: 'الموقع الجغرافي غير متاح',
        notAvailableDesc: 'متصفحك لا يدعم تحديد الموقع.',
        setTitle: 'تم تعيين الموقع',
        setDesc: '{lat}، {lng}',
        couldNotGetTitle: 'تعذر الحصول على الموقع',
        couldNotGetDesc: 'تم رفض الإذن',
      },
      ai: {
        suggestions: 'اقتراحات الذكاء الاصطناعي:',
      },
      map: {
        selected: 'المختار',
        clickToSet: 'انقر على الخريطة لتحديد موقع دقيق.',
        openInOSM: 'فتح في خريطة OSM',
      },
    },
    dashboard: {
      services: {
        title: 'خدماتي',
        subtitle: 'اعرض وأدر جميع قوائم خدماتك.',
        newService: 'خدمة جديدة',
        seedSamples: 'إضافة عينات',
        loading: 'جارٍ التحميل…',
        emptyTitle: 'لا توجد خدمات بعد.',
        createFirst: 'أنشئ أول خدمة لك',
        seedSampleServices: 'إضافة خدمات تجريبية',
        table: {
          headers: {
            title: 'العنوان',
            category: 'الفئة',
            city: 'المدينة',
            price: 'السعر (د.ل)',
            actions: 'الإجراءات',
          },
        },
        actions: {
          view: 'عرض',
          edit: 'تعديل',
          delete: 'حذف',
        },
        toast: {
          deleted: 'تم حذف الخدمة',
          deleteFailed: 'فشل الحذف',
          seeded: 'تم إنشاء خدمات تجريبية',
          seedFailed: 'فشل إضافة العينات',
        },
        confirmDelete: 'هل تريد حذف هذه الخدمة؟ هذا الإجراء لا يمكن التراجع عنه.',
      },
    },
    map: {
      usingOSMBadge: 'يتم استخدام خرائط OpenStreetMap (مجاني)'
    },
  },
} as const;

function get(obj: any, path: string): string | undefined {
  return path.split('.').reduce((acc, k) => (acc && acc[k] != null ? acc[k] : undefined), obj);
}

export function tr(locale: Locale, key: string): string {
  const d = dict[locale] ?? dict.en;
  const v = get(d, key);
  if (typeof v === 'string') return v;
  // fallback to en
  const ve = get(dict.en, key);
  return typeof ve === 'string' ? ve : key;
}

export function getClientLocale(): Locale {
  try {
    if (typeof document === 'undefined') return 'en';
    const m = document.cookie.match(/(?:^|; )locale=([^;]+)/);
    const fromCookie = (m?.[1] || '').toLowerCase();
    const fromHtml = (document.documentElement.getAttribute('lang') || 'en').toLowerCase();
    const l = (fromCookie || fromHtml).startsWith('ar') ? 'ar' : 'en';
    return l as Locale;
  } catch {
    return 'en';
  }
}

export const dictionaries = dict;
