export type Locale = 'en' | 'ar';

const dict = {
  en: {
    header: {
      browse: 'Browse Services',
      providers: 'For Providers',
      providerDashboard: 'Provider Dashboard',
      myServices: 'My Services',
      addService: 'Add New Service',
      profile: 'Profile',
      signOut: 'Sign Out',
      login: 'Login / Sign Up',
      switch: 'Switch language',
    },
    login: {
      welcome: 'Welcome',
      subtitle: 'Sign in or create an account to continue',
      tabs: { signin: 'Sign In', signup: 'Sign Up' },
      fields: {
        email: 'Email',
        password: 'Password',
        roleLabel: 'I am a...',
        roleSeeker: 'Service Seeker (Looking for a professional)',
        roleProvider: 'Service Provider (Offering my services)',
      },
      actions: {
        signIn: 'Sign In',
        signUp: 'Create Account',
        forgot: 'Forgot password?',
      },
      toasts: {
        accountCreatedTitle: 'Account Created',
        accountCreatedDesc: 'You have been successfully signed up.',
        signedInTitle: 'Signed In',
        signedInDesc: 'You have been successfully signed in.',
        emailInUseTitle: 'Email already in use',
        emailInUseDesc: 'We switched you to Sign In. If you forgot your password, click "Forgot password?"',
        signUpFailedTitle: 'Sign Up Failed',
        signUpFailedDesc: 'An unexpected error occurred.',
        signOutFailedTitle: 'Sign Out Failed',
        signOutFailedDesc: 'There was an error signing out.',
        emailRequiredTitle: 'Email required',
        emailRequiredDesc: 'Enter your email, then click Forgot password.',
        resetSentTitle: 'Password reset sent',
        resetSentDesc: 'Check your email for a reset link.',
        resetFailedTitle: 'Reset failed',
        resetFailedDesc: 'Could not send reset email.',
        redirectFailedTitle: 'Redirect failed',
        redirectFailedDesc: 'Could not retrieve user profile for redirection.',
        verifyEmailSentTitle: 'Verification email sent',
        verifyEmailSentDesc: 'Please check your inbox and click the link to verify.',
        pleaseVerifyTitle: 'Please verify your email',
        pleaseVerifyDesc: 'We sent you a verification email. Verify to continue.',
      },
    },
    verify: {
      title: 'Verify your email',
      description: 'A verification link was sent to your email. Please click the link, then return here.',
      resend: 'Resend verification email',
      check: 'I verified — Refresh',
      verifiedTitle: 'Email verified',
      verifiedDesc: 'Redirecting…',
      notVerifiedTitle: 'Not verified yet',
      notVerifiedDesc: 'Please check your inbox (or spam) and click the link.',
    },
    home: {
      heroTitle: 'Find Local Services You Can Trust',
      heroSubtitle: 'Your connection to skilled professionals in Libya.',
      providerCta: 'I am a Provider – List my service',
      seekerCta: 'I am a Seeker – Find services',
      searchPlaceholder: 'What service are you looking for?',
      cityPlaceholder: 'City',
      categoryPlaceholder: 'Category',
      allCities: 'All Cities',
      allCategories: 'All Categories',
      maxPricePlaceholder: 'Max price',
      search: 'Search',
      featuredCategories: 'Featured Categories',
      popularServices: 'Popular Services',
      loading: 'Loading services…',
      empty1: 'No services yet.',
      empty2: 'Go to Dashboard → My Services to create a new service.',
      sortBy: 'Sort by',
      sortNewest: 'Newest',
      sortPriceLow: 'Price: Low to High',
      sortPriceHigh: 'Price: High to Low',
    },
    // NEW COMMON SECTION
    common: {
      loading: 'Loading...',
      error: 'An error occurred',
      retry: 'Retry',
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      confirm: 'Confirm',
      search: 'Search',
      noResults: 'No results found',
      success: 'Success',
      failed: 'Failed',
      required: 'Required',
      optional: 'Optional',
      yes: 'Yes',
      no: 'No',
      close: 'Close',
      next: 'Next',
      previous: 'Previous',
      submit: 'Submit',
      processing: 'Processing...',
      update: 'Update',
      create: 'Create',
      edit: 'Edit',
      view: 'View',
      back: 'Back',
      continue: 'Continue',
      done: 'Done',
      skip: 'Skip',
      more: 'More',
      less: 'Less',
      show: 'Show',
      hide: 'Hide',
      active: 'Active',
      inactive: 'Inactive',
      enabled: 'Enabled',
      disabled: 'Disabled',
      connected: 'Connected',
      disconnected: 'Disconnected',
      online: 'Online',
      offline: 'Offline',
      readMore: 'Read More',
      showLess: 'Show Less',
    },
    categories: {
      Plumbing: 'Plumbing',
      Electrical: 'Electrical',
      Carpentry: 'Carpentry',
      'Home Services': 'Home Services',
      Cleaning: 'Cleaning',
      Painting: 'Painting',
      HVAC: 'HVAC',
      'Air Conditioning': 'Air Conditioning',
      'Appliance Repair': 'Appliance Repair',
      Roofing: 'Roofing',
      Flooring: 'Flooring',
      Tiling: 'Tiling',
      Gardening: 'Gardening',
      Landscaping: 'Landscaping',
      'Pest Control': 'Pest Control',
      Moving: 'Moving',
      Handyman: 'Handyman',
      'Security Systems': 'Security Systems',
      'IT & Computer Repair': 'IT & Computer Repair',
      'Mobile Repair': 'Mobile Repair',
      'Web Development': 'Web Development',
      'Graphic Design': 'Graphic Design',
      Photography: 'Photography',
      Videography: 'Videography',
      'Beauty & Personal Care': 'Beauty & Personal Care',
      'Hair & Makeup': 'Hair & Makeup',
      'Fitness & Personal Training': 'Fitness & Personal Training',
      Tutoring: 'Tutoring',
      Education: 'Education',
      Translation: 'Translation',
      'Legal Services': 'Legal Services',
      'Accounting & Tax': 'Accounting & Tax',
      Insurance: 'Insurance',
      'Real Estate': 'Real Estate',
      Automotive: 'Automotive',
      'Car Wash & Detailing': 'Car Wash & Detailing',
      'Car Repair': 'Car Repair',
      'Motorcycle Repair': 'Motorcycle Repair',
      'Transport & Delivery': 'Transport & Delivery',
      'Event Planning': 'Event Planning',
      Catering: 'Catering',
      'Furniture Assembly': 'Furniture Assembly',
      'Tailoring & Alterations': 'Tailoring & Alterations',
      Printing: 'Printing',
      'Metalwork & Welding': 'Metalwork & Welding',
      'Masonry & Concrete': 'Masonry & Concrete',
      'Water Tank Services': 'Water Tank Services',
      'Water & Sanitation': 'Water & Sanitation',
      'Waste Removal': 'Waste Removal',
      'Solar & Renewable Energy': 'Solar & Renewable Energy',
      'Satellite & TV': 'Satellite & TV',
      'Internet & Networking': 'Internet & Networking',
      'Electrical Appliances Install': 'Electrical Appliances Install',
      'Childcare & Nanny': 'Childcare & Nanny',
      'Elderly Care': 'Elderly Care',
      'Pet Services': 'Pet Services',
      'Agriculture Services': 'Agriculture Services',
      'Boat & Marine': 'Boat & Marine',
      Locksmith: 'Locksmith',
      'Glass & Aluminum': 'Glass & Aluminum',
      'Interior Design': 'Interior Design',
      'Architecture & Engineering': 'Architecture & Engineering',
      // Marketing & Stores
      'Digital Marketing': 'Digital Marketing',
      'Social Media Marketing': 'Social Media Marketing',
      SEO: 'SEO',
      'SEM & Paid Ads': 'SEM & Paid Ads',
      'Content Marketing': 'Content Marketing',
      Copywriting: 'Copywriting',
      Branding: 'Branding',
      Advertising: 'Advertising',
      'Influencer Marketing': 'Influencer Marketing',
      'Email Marketing': 'Email Marketing',
      'SMS Marketing': 'SMS Marketing',
      'Affiliate Marketing': 'Affiliate Marketing',
      'PR & Communications': 'PR & Communications',
      'Market Research': 'Market Research',
      'Retail & Store Fit-out': 'Retail & Store Fit-out',
      'Visual Merchandising': 'Visual Merchandising',
      'Point of Sale (POS) Setup': 'Point of Sale (POS) Setup',
      'Storefront Signage': 'Storefront Signage',
      'Shop Interior Design': 'Shop Interior Design',
      'Inventory Setup': 'Inventory Setup',
      'E-commerce Setup': 'E-commerce Setup',
      'Marketplace Listings': 'Marketplace Listings',
      'Packaging & Label Design': 'Packaging & Label Design',
      Sales: 'Sales',
    },
    details: {
      loading: 'Loading service…',
      notFoundTitle: 'Service not found',
      notFoundBodyError: 'There was a problem loading this service.',
      notFoundBodyRemoved: 'This service may have been removed.',
      goHome: 'Go to homepage',
      backToMyServices: 'Back to My Services',
      description: 'Description',
      availability: 'Availability',
      location: 'Location',
      approxIn: 'Approximate location in',
      video: 'Video',
      servicePrice: 'Service Price',
      viewOnMap: 'View on map',
      contactWhatsApp: 'Contact via WhatsApp',
      callProvider: 'Call Provider',
      noContact: 'Contact details not provided.',
      chatInApp: 'Chat with Provider',
      requestService: 'Request Service',
      requestSent: 'Request sent',
      requestFailed: 'Could not send request',
      reviews: 'Reviews & Ratings',
    },
    chat: {
      title: 'Chat',
      typeMessage: 'Type a message…',
      send: 'Send',
      start: 'Start a conversation',
      notAllowed: 'You do not have access to this conversation.',
      signInPrompt: 'Please sign in to chat.',
      empty: 'No messages yet.'
    },
    reviews: {
      ratingLabel: 'Your rating',
      writeReview: 'Write a review',
      placeholder: 'Share your experience (optional, up to 1000 characters)…',
      submit: 'Submit review',
      update: 'Update review',
      delete: 'Delete review',
      signInPrompt: 'Sign in to leave a review.',
      ownerBlocked: 'You cannot review your own service.',
      empty: 'No reviews yet.',
      toasts: {
        saved: 'Review saved',
        deleted: 'Review deleted',
        saveFailed: 'Could not save review',
        deleteFailed: 'Could not delete review',
        requiredRating: 'Please select a star rating.',
      },
    },
    form: {
      labels: {
        title: 'Service Title',
        description: 'Description',
        category: 'Category',
        price: 'Price (in LYD)',
        city: 'City',
        area: 'Area / Neighborhood',
        latitude: 'Latitude (optional)',
        longitude: 'Longitude (optional)',
        advancedLocation: 'Advanced location (optional)',
        pickLocation: 'Pick location on map (optional)',
        mapUrl: 'Map URL (optional)',
        availabilityNote: 'Availability Note (optional)',
        contactPhone: 'Contact Phone',
        contactWhatsapp: 'WhatsApp Number',
        videoUrl: 'YouTube Video URL (optional)',
        videoUrls: 'Additional YouTube Links',
        facebookUrl: 'Facebook URL (optional)',
        telegramUrl: 'Telegram URL (optional)',
        images: 'Service Images (1-8)',
      },
    },
    dashboard: {
      services: {
        title: 'خدماتي',
        subtitle: 'اعرض وأدر جميع قوائم خدماتك.',
        newService: 'خدمة جديدة',
        seedSamples: 'إضافة عينات',
        loading: 'جارٍ التحميل…',
        emptyTitle: 'لا توجد خدمات بعد.',
        createFirst: 'أنشئ أول خدمة لك',
        seedSampleServices: 'إضافة خدمات تجريبية',
        table: {
          headers: {
            title: 'العنوان',
            category: 'الفئة',
            city: 'المدينة',
            price: 'السعر (د.ل)',
            actions: 'الإجراءات',
          },
        },
        actions: {
          view: 'عرض',
          edit: 'تعديل',
          delete: 'حذف',
        },
        toast: {
          deleted: 'تم حذف الخدمة',
          deleteFailed: 'فشل الحذف',
          seeded: 'تم إنشاء خدمات تجريبية',
          seedFailed: 'فشل إضافة العينات',
        },
        confirmDelete: 'هل تريد حذف هذه الخدمة؟ هذا الإجراء لا يمكن التراجع عنه.',
      },
      serviceForm: {
        newTitle: 'إنشاء خدمة جديدة',
        newSubtitle: 'املأ التفاصيل أدناه لإضافة خدمتك في خدمتي كونكت.',
        editTitle: 'تعديل الخدمة',
        editSubtitle: 'قم بتحديث معلومات قائمتك.',
        saveChanges: 'حفظ التغييرات',
        saving: 'جارٍ الحفظ…',
        notAllowedTitle: 'غير مسموح',
        notAllowedDesc: 'يمكنك فقط تعديل خدماتك الخاصة.',
      },
      sidebar: {
        myServices: 'خدماتي',
        addService: 'إضافة خدمة جديدة',
        analytics: 'التحليلات',
        profile: 'الملف الشخصي',
        settings: 'الإعدادات',
      },
      welcome: {
        title: 'مرحبًا بك في لوحة التحكم',
        subtitle: 'قم بإدارة خدماتك وملفك الشخصي واطّلع على التحليلات.',
        prompt: 'اختر عنصرًا من الشريط الجانبي للبدء.',
        goServices: 'اذهب إلى خدماتي',
        addService: 'إضافة خدمة جديدة',
      },
      profile: {
        title: 'ملفك الشخصي',
        subtitle: 'حدّث معلوماتك الشخصية وبيانات التواصل.',
        labels: {
          name: 'الاسم الكامل',
          phone: 'رقم الهاتف',
          whatsapp: 'رقم واتساب',
          city: 'المدينة',
        },
        actions: {
          save: 'حفظ التغييرات',
          saving: 'جارٍ الحفظ…',
        },
      },
    },
    map: {
      usingOSMBadge: 'يتم استخدام خرائط OpenStreetMap (مجاني)'
    },
    footer: {
      about: 'من نحن',
      terms: 'شروط الخدمة',
      privacy: 'سياسة الخصوصية',
      contact: 'تواصل معنا',
      rights: 'جميع الحقوق محفوظة.',
    },
    pages: {
      about: { title: 'حول خدماتي كونكت' },
      terms: { title: 'شروط الخدمة' },
      privacy: { title: 'سياسة الخصوصية' },
      contact: { title: 'اتصال' },
      pricing: {
        nav: 'الأسعار',
        title: 'أسعار بسيطة تنمو معك',
        subtitle: 'اختر الخطة المناسبة لاحتياجاتك. يمكنك الترقية في أي وقت.',
        perMonth: 'شهريًا',
        choosePlan: 'اختيار الخطة',
        plans: {
          basic: { name: 'أساسي' },
          pro: { name: 'محترف' },
          enterprise: { name: 'مؤسسات' },
        },
        features: {
          basic: {
            l1: 'أضف خدماتك وتلقَّى تواصلًا',
            l2: 'تحليلات أساسية',
          },
          pro: {
            l1: 'تعزيز أولوية الظهور',
            l2: 'تحليلات متقدمة ورؤى',
            l3: 'طرق تواصل متعددة',
            l4: 'دعم عبر البريد/واتساب',
          },
          enterprise: {
            l1: 'تمييز بارز عبر الفئات',
            l2: 'حسابات فريق وصلاحيات',
            l3: 'إعداد مخصص وتدريب',
            l4: 'مدير نجاح مخصص',
          },
        },
      },
      checkout: {
        title: 'إتمام الدفع',
        subtitle: 'أكمل الدفع لتفعيل اشتراكك.',
        txId: 'معرّف العملية',
        plan: 'الخطة',
        amount: 'المبلغ',
        status: 'الحالة',
        statusLabels: {
          pending: 'قيد الانتظار',
          success: 'تم الدفع',
          failed: 'فشل',
          cancelled: 'أُلغيت',
        },
        scanHelp: 'امسح باستخدام تطبيق المحفظة',
        openWallet: 'فتح في تطبيق المحفظة',
        copyCode: 'نسخ رمز الدفع',
        refresh: 'لقد دفعت، تحديث',
        openWeb: 'فتح المحفظة (ويب)',
        openFail: 'تعذر فتح تطبيق المحفظة. إذا لم يكن مثبتًا، امسح رمز QR أو انسخ رمز الدفع.',
        desktopHint: 'على الجوال، اضغط "فتح في تطبيق المحفظة". على الحاسوب، امسح رمز QR. ستتحدّث هذه الصفحة تلقائيًا بعد تأكيد الدفع.',
        failedNotice: 'فشلت عملية الدفع. الرجاء العودة إلى صفحة الأسعار والمحاولة مرة أخرى.',
        cancelledNotice: 'تم إلغاء عملية الدفع. يمكنك المحاولة مرة أخرى من صفحة الأسعار.',
      },
    },
  },
  ar: {
    header: {
      browse: 'تصفح الخدمات',
      providers: 'للمقدّمين',
      providerDashboard: 'لوحة المزود',
      myServices: 'خدماتي',
      addService: 'إضافة خدمة جديدة',
      profile: 'الملف الشخصي',
      signOut: 'تسجيل الخروج',
      login: 'تسجيل الدخول / إنشاء حساب',
      switch: 'تغيير اللغة',
    },
    common: {
      loading: 'جار التحميل...',
      error: 'حدث خطأ',
      retry: 'إعادة المحاولة',
      save: 'حفظ',
      cancel: 'إلغاء',
      delete: 'حذف',
      confirm: 'تأكيد',
      search: 'بحث',
      noResults: 'لا توجد نتائج',
      success: 'نجح',
      failed: 'فشل',
      required: 'مطلوب',
      optional: 'اختياري',
      yes: 'نعم',
      no: 'لا',
      close: 'إغلاق',
    },
    form: {
      labels: {
        title: 'عنوان الخدمة',
        description: 'الوصف',
        category: 'الفئة',
        price: 'السعر (بالدينار الليبي)',
        city: 'المدينة',
        area: 'المنطقة / الحي',
        latitude: 'خط العرض (اختياري)',
        longitude: 'خط الطول (اختياري)',
        advancedLocation: 'موقع متقدم (اختياري)',
        pickLocation: 'اختر الموقع على الخريطة (اختياري)',
        mapUrl: 'رابط الخريطة (اختياري)',
        availabilityNote: 'ملاحظة التوفر (اختياري)',
        contactPhone: 'رقم الهاتف',
        contactWhatsapp: 'رقم واتساب',
        videoUrl: 'رابط فيديو يوتيوب (اختياري)',
        videoUrls: 'روابط يوتيوب إضافية',
        facebookUrl: 'رابط فيسبوك (اختياري)',
        telegramUrl: 'رابط تيليغرام (اختياري)',
        images: 'صور الخدمة (1-8)',
      },
      subservices: {
        label: 'الخدمات الفرعية',
        empty: 'لا توجد خدمات فرعية بعد.',
        title: 'العنوان',
        price: 'السعر',
        unit: 'الوحدة',
        unitPlaceholder: 'بالساعة / لكل قطعة',
        description: 'الوصف',
        descriptionPlaceholder: 'تفاصيل قصيرة…',
        add: 'إضافة خدمة فرعية',
        remove: 'حذف',
        total: 'مجموع الخدمات الفرعية',
        autoCalc: 'يتم احتساب السعر تلقائيًا من مجموع الخدمات الفرعية.',
      },
      placeholders: {
        title: 'مثال: صيانة وتكييف منازل باحترافية',
        description: 'صف خدمتك بالتفصيل...',
        availability: 'مثال: متاح مساءً وعطلات نهاية الأسبوع',
        searchAddress: 'ابحث عن عنوان أو مكان (مجاني)',
        contactPhone: 'مثال: +218911234567',
        contactWhatsapp: 'مثال: +218911234567',
      },
      help: {
        description: 'بحد أقصى 800 حرف. كن واضحًا ومختصرًا.',
        videoUrl: 'ألصق رابط يوتيوب وسيتم تضمينه في صفحة خدمتك.',
        imageTypes: 'PNG أو JPG أو WebP (حد أقصى 8 صور)',
        coverImage: 'ستكون الصورة الأولى هي صورة الغلاف الرئيسية للخدمة.',
      },
      actions: {
        improve: 'تحسين',
        useMyLocation: 'استخدم موقعي',
        clearLocation: 'مسح الموقع',
        clickToUpload: 'انقر للرفع أو اسحب وأفلت',
        createService: 'إنشاء الخدمة',
      },
      images: {
        selectedCount: 'تم اختيار {count} ملف: {names}',
      },
      toasts: {
        createdTitle: 'تم إنشاء الخدمة',
        createdDesc: 'تم نشر خدمتك بنجاح.',
        createFailedTitle: 'تعذر إنشاء الخدمة',
      },
      map: {
        selected: 'المختار',
        clickToSet: 'انقر على الخريطة لتحديد موقع دقيق.',
        openInOSM: 'فتح في خريطة OSM',
      },
      geo: {
        notAvailableTitle: 'الموقع الجغرافي غير متاح',
        notAvailableDesc: 'متصفحك لا يدعم تحديد الموقع.',
      },
      ai: { suggestions: 'اقتراحات الذكاء الاصطناعي:' },
    },
    dashboard: {
      serviceForm: {
        newTitle: 'إنشاء خدمة جديدة',
        newSubtitle: 'املأ التفاصيل أدناه لإضافة خدمتك في خدمتي كونكت.',
        editTitle: 'تعديل الخدمة',
        editSubtitle: 'قم بتحديث معلومات قائمتك.',
        saveChanges: 'حفظ التغييرات',
        saving: 'جارٍ الحفظ…',
        notAllowedTitle: 'غير مسموح',
        notAllowedDesc: 'يمكنك فقط تعديل خدماتك الخاصة.',
      },
    },
    map: { usingOSMBadge: 'يتم استخدام خرائط OpenStreetMap (مجاني)' },
    footer: {
      about: 'من نحن',
      terms: 'شروط الخدمة',
      privacy: 'سياسة الخصوصية',
      contact: 'تواصل معنا',
      rights: 'جميع الحقوق محفوظة.',
    },
  },
} as const;

function get(obj: any, path: string): any {
  try {
    return path.split('.').reduce((acc: any, key: string) => (acc && typeof acc === 'object' ? acc[key] : undefined), obj);
  } catch {
    return undefined;
  }
}

export function tr(locale: Locale, key: string): string {
  try {
    const d = (dict as any)[locale] ?? (dict as any).en;
    const v = get(d, key);
    if (typeof v === 'string') return v;
    
    const ve = get((dict as any).en, key);
    if (typeof ve === 'string') return ve;
    
    // Log missing translations in development
    if (process.env.NODE_ENV !== 'production') {
      console.warn(`[i18n] Missing translation for key: "${key}" in locale: "${locale}"`);
    }
    
    return key;
  } catch (error) {
    console.error(`[i18n] Error getting translation for key: "${key}"`, error);
    return key;
  }
}

export function getClientLocale(): Locale {
  try {
    if (typeof document === 'undefined') return 'ar';
    const m = document.cookie.match(/(?:^|; )locale=([^;]+)/);
    const fromCookie = (m?.[1] || '').toLowerCase();
    const fromHtml = (document.documentElement.getAttribute('lang') || 'en').toLowerCase();
    const l = (fromCookie || fromHtml).startsWith('ar') ? 'ar' : 'en';
    return l as Locale;
  } catch {
    return 'ar';
  }
}

export const dictionaries = dict;